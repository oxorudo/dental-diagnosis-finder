{% load static %}
{% load custom_filters %}
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        {% block title %}치과 상병 코드 검색{% endblock %}
    </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <!-- Font Awesome 추가 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 왼쪽 드롭다운 메뉴 -->
            <nav id="sidebar" class="col-md-2 d-none d-md-block bg-light sidebar">
                <div class="position-sticky">
                    <!-- 사이드메뉴 열고 닫기 버튼 -->
                    <button id="toggle-sidebar" class="btn btn-secondary btn-sm">
                        <i id="sidebar-icon" class="fas fa-bars"></i>
                    </button>

                    <div class="category-title">병명 카테고리</div>
                    <ul class="nav flex-column">
                        {% for parent_code, parent_data in full_hierarchy.items %}
                        <li>
                            <a href="#" class="major-category btn btn-primary" data-code="{{ parent_code }}">{{ parent_code|remove_last_char }} - {{ parent_data.name }}</a>
                            <ul style="display:none;">
                                {% for middle_code, middle_data in parent_data.children.items %}
                                <li>
                                    <a href="#" class="middle-category" data-code="{{ middle_code }}">{{ middle_code }}
                                        {% if middle_data.has_subcategories %}~{% endif %}
                                        - {{ middle_data.name }}</a>
                                    <ul style="display:none;">
                                        {% for sub_code, sub_data in middle_data.children.items %}
                                        <li>
                                            <a href="#" class="sub-category" data-code="{{ sub_code }}">{{ sub_code }} - {{ sub_data.name }}</a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </li>
                                {% endfor %}
                            </ul>
                        </li>
                        {% empty %}
                        <li>카테고리가 없습니다</li>
                        {% endfor %}
                    </ul>
                    <div class="mt-3">
                        <a href="#" id="add-button" class="btn btn-primary">추가</a>
                    </div>
                </div>
            </nav>
            <!-- Main content -->
            <main id="main-content" class="col-md-10 ms-sm-auto col-lg-10 px-md-4 py-4">

                <!-- Search bar -->
                <div class="justify-content-between align-items-center search-area">
                    <form method="GET" action="{% url 'search_view' %}" class="d-flex w-100">
                        <input type="text" class="form-control me-2" name="q" id="search-input" placeholder="상병 코드 또는 상병명을 입력하세요" value="{{ query }}" autocomplete="off">
                        <button class="btn btn-primary search-btn" type="submit">검색</button>
                    </form>
                </div>

                <!-- Table and details section -->
                <div class="row mt-4">
                    <div class="col-md-12 result-table">
                        <!-- Header Table -->
                        <div class="table-header-wrapper">
                            <table class="table table-fixed-header">
                                <thead class="table-light">
                                    <tr>
                                        <th class="col-code">불완전 상병 코드</th>
                                        <th class="col-name">불완전 상병명</th>
                                        <th class="col-category">카테고리</th>
                                        <th class="col-details">세부 청구 항목</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>

                        <!-- Body Table with Scroll -->
                        <div class="table-responsive table-body-wrapper">
                            <table class="table">
                                <tbody id="result-body">
                                    <!-- 검색 결과가 여기에 동적으로 추가됩니다. -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
                <script src="{% static 'scripts.js' %}"></script>
                <script src="{% static 'detailButtonHandler.js' %}"></script>
            </main>
        </div>
    </div>
</body>

</html>